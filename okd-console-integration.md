# OKD Console Integration See also associated [git issue](https://github.ibm.com/WASCloudPrivate/roadmap-convergence/issues/871). The OKD console supports various [customization capabilities](https://docs.okd.io/latest/install_config/web_console_customization.html#web-console-application-launcher3) in its console design. App Navigator will exploit two of these capabilities: featured application and application launcher. Each of these provides a way to make the App Navigator UI's URL easily accessible to the OKD console user. We call this 'OKD Console Integration' or in this design section, simply 'integration' for short. The user will have an option to choose which type of integration they prefer because the two integrations are visibly quite different from one another. Featured applications take up a lot of vertical space in the menu bar; while application launchers are menu items in a small drop down control in the menu bar, left of the help icon. ## Integration Configuration The user will have a choice of featured application or application launcher. App Navigator will provide configuration switch for the user to designate which integration to use. Featured application is the default. The switch will be a variable in the App Nav Helm Chart and a field in the App Nav Operator CRD. External switch in values.yaml: ``` console: okdFeaturedApp: enabled okdAppLauncher: disabled ``` Notes: 1. While there is no obvious reason to allow the user to enable both integrations, neither is there a reason to prevent it. So user can enable (or disable) both integrations according to their preference. 2. These integrations only work when App Navigator is installed on an OpenShift distribution. If App Navigator is ever used on any other Kubernetes distribution, these settings are ignored. Implementation notes: Switch implementation requires three updates: 1. define switch in Helm chart [variables.yaml](https://github.ibm.com/WASCloudPrivate/helm-chart-prism/blob/master/stable/ibm-app-navigator/values.yaml) 1. set switch in [prism-config config map](https://github.ibm.com/WASCloudPrivate/helm-chart-prism/blob/master/stable/ibm-app-navigator/templates/prism-config.yaml) 1. use switch during app nav install in [init-prish.sh](https://github.ibm.com/WASCloudPrivate/prism/blob/master/install/init-prism.sh). When either of the switches are enabled, the corresponding integration must be installed if and only if App Navigator is running on an OpenShift distribution. To check at runtime if running on an OpenShift distribution, check the [kubeEnv environment variable](https://github.com/kappnav/design/blob/master/kubeEnv-Env-var.md). ## Integration Architecture ![pic](https://github.com/kappnav/design/blob/master/images/okd-console-intg.png) 1. When the user installs AppNav, they set the okd integration options according to their choice using the operator's kubernetes manifest. The operator sets the corresponding value in the prism-config config map. 1. The prism-init.sh script (runs as a kubernetes job during AppNav install) reads the okd integration setting from prism-config to determine the user's desired integrations. 1. The prism-init.sh script (when running on an OpenShift distribution) configures the OKD (OpenShift) console with the URLs for either app launcher js config, featured app js config, or both. 1. During OKD console initialization, it reads its config, which includes the integration customization set by prism-init.sh. 1. During OKD console initialization, it also invokes the integration customization URLs (if configured) to retrieve the js integration configurations served up by the AppNav UI server. This causes the launch widgets in the console (featured app button and/or app launcher menu item) to be displayed. 1. While using OKD console, user can click the app launcher menu item (depicted above) or featured app button (not depicted above) depending on their configuration choices.
